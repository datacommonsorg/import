steps:
  - name: 'maven:3.9.1'
    args: ['package']
    entrypoint: mvn
    secretEnv:
      - AUTOPUSH_DC_API_KEY

  - name: 'gcr.io/cloud-builders/gsutil'
    args: ['cp', 'tool/target/datacommons-import-tool-0.1-SNAPSHOT-jar-with-dependencies.jar', 'gs://datacommons_public/import_tools/import-tool.jar']

  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['builds', 'triggers', 'run', 'dc-import-executor', '--branch=master', '--substitutions', '_DOCKER_IMAGE=us-docker.pkg.dev/datcom-ci/gcr.io/dc-import-executor']

availableSecrets:
  secretManager:
    - versionName: projects/datcom-ci/secrets/autopush-dc-api-key/versions/latest
      env: AUTOPUSH_DC_API_KEY

